<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title-1">Reviews</h3>
  </div>

  <div class="panel-body">
    <div class="star-rating" data-score= <%= @average_review %> ></div>
    <p><em>(<%= pluralize(@reviews.length, "Review") %>)</em></p>

    <h4 class="panel-title">What do you think of <%= @product.name %>?</h4>
    <p>Share your thoughts with the community.</p>

    <%= link_to "Write a review", new_product_review_path(@product), class: 'btn btn-default btn-lg' %>
  </div>

  <ul class="list-group">
    <% @reviews.each do |review| %>
      <li class="list-group-item">
        <div class="star-rating" data-score= <%= review.rating %> ></div>
          <p>By <%= review.user.full_name %> on <%= review.created_at.strftime("%B %d, %Y") %></p>
          <p><%= review.content %></p>
          <p>
            <% if can? :update, review %>
              <%= link_to 'Edit review', edit_product_review_path(@product, review), class: 'btn btn-default' %>
            <% end %>

            <% if can? :destroy, review %>
              <%= link_to 'Delete review', [@product, review], method: :delete, class: 'btn btn-default', data: {confirm: "Are you sure you want to delete this review?"} %>
            <% end %>
          </p>
      </li>
    <% end %>
  </ul>
</div>

<script>
$('.star-rating').raty({
  path: '/assets/',
  readOnly: true,
  score: function() { return $(this).attr('data-score') }
});
</script>
